{% extends 'base.html' %}

{% block titulo %}Modificar Post: {{ object.titulo }}{% endblock %}

{% block contenido %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    
    <nav class="flex mb-6 text-sm">
        <ol class="inline-flex items-center space-x-2">
            <li><a href="{% url 'apps.posts:posts' %}" class="text-gray-500 hover:text-chaco-green">Posts</a></li>
            <li><span class="text-gray-400">/</span></li>
            <li><a href="{% url 'apps.posts:post_individual' id=object.id %}" class="text-gray-500 hover:text-chaco-green">Ver Post</a></li>
            <li><span class="text-gray-400">/</span></li>
            <li class="text-gray-900 font-medium">Modificar</li>
        </ol>
    </nav>
    
    <div class="bg-white rounded-xl shadow-2xl p-8 border border-gray-100">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6 flex items-center">
            ✍️ Modificar Post
        </h1>
        
        <p class="text-gray-600 mb-6">Estás editando el post: **{{ object.titulo }}**</p>

        <form method="POST" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            {# Mostrar errores generales del formulario #}
            {% if form.non_field_errors %}
                <div class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 border border-red-200">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            {# Título #}
            <div>
                <label for="{{ form.titulo.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Título</label>
                {{ form.titulo }}
                {% if form.titulo.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.titulo.errors|striptags }}</p>
                {% endif %}
            </div>

            {# Subtítulo (Opcional) #}
            <div>
                <label for="{{ form.subtitulo.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Subtítulo (Opcional)</label>
                {{ form.subtitulo }}
                {% if form.subtitulo.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.subtitulo.errors|striptags }}</p>
                {% endif %}
            </div>

            {# Categoría (con botón para crear nueva) #}
            <div class="flex items-end space-x-4">
                <div class="flex-grow">
                    <label for="{{ form.categoria.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Categoría</label>
                    {{ form.categoria }}
                    {% if form.categoria.errors %}
                        <p class="mt-2 text-sm text-red-600">{{ form.categoria.errors|striptags }}</p>
                    {% endif %}
                </div>
                <a href="{% url 'apps.posts:crear_categoria' %}?next={% url 'apps.posts:post_update' pk=object.id %}" 
                   class="flex-shrink-0 px-4 py-2 bg-chaco-light border border-chaco-green text-chaco-green text-sm font-semibold rounded-lg hover:bg-chaco-green/10 transition-colors mb-0.5">
                    + Nueva Categoría
                </a>
            </div>

            {# Texto/Contenido del Post #}
            <div>
                <label for="{{ form.texto.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Contenido del Post</label>
                {{ form.texto }}
                {% if form.texto.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.texto.errors|striptags }}</p>
                {% endif %}
            </div>

            {# Imagen #}
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Imagen Actual</label>
                {% if object.imagen %}
                    <p class="mb-2 text-sm text-gray-500">
                        <a href="{{ object.imagen.url }}" target="_blank" class="text-blue-500 hover:text-blue-700">Ver imagen actual</a>
                    </p>
                    {% if form.imagen.value %}
                        <div class="w-full max-w-xs mb-3">
                            <img src="{{ object.imagen.url }}" alt="Imagen actual" class="w-full h-auto object-cover rounded-lg border border-gray-200">
                        </div>
                    {% endif %}
                    
                    {# Checkbox para borrar imagen #}
                    <div class="flex items-center space-x-2">
                        {{ form.imagen_clear }}
                        <label for="{{ form.imagen_clear.id_for_label }}" class="text-sm text-gray-700">Eliminar imagen actual</label>
                    </div>
                {% else %}
                    <p class="mb-2 text-sm text-gray-500">No hay imagen asociada.</p>
                {% endif %}

                <label for="{{ form.imagen.id_for_label }}" class="block text-sm font-medium text-gray-700 mt-4 mb-1">Cambiar Imagen</label>
                {{ form.imagen }}
                {% if form.imagen.errors %}
                    <p class="mt-2 text-sm text-red-600">{{ form.imagen.errors|striptags }}</p>
                {% endif %}
            </div>

            <div class="pt-4 border-t border-gray-100">
                <input type="submit" value="Guardar Cambios" class="w-full px-6 py-3 bg-chaco-green text-white font-semibold rounded-lg hover:bg-chaco-green/90 transition-all cursor-pointer shadow-lg">
            </div>
        </form>
    </div>
</div>

<style>
/* Estilos para los campos del formulario generados por Django */
input[type="text"], 
input[type="file"],
textarea, 
select {
    @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-chaco-green focus:border-transparent;
}
textarea {
    @apply min-h-[150px] resize-y;
}
select {
    @apply appearance-none bg-white pr-8;
}

/* Ocultar el texto de la etiqueta de archivo "Actual: ..." */
.form-row .clearable-file-input {
    @apply hidden;
}
</style>

{% endblock %}